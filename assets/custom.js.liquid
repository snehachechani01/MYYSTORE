<script>
  // Function to check if the free product is already in the cart
  function isFreeProductInCart(productId) {
    var isFreeProductInCart = false;

    // Loop through the cart items to check if the free product is present
    {% for item in cart.items %}
      if (item.product_id == productId) {
        isFreeProductInCart = true;
        break;
      }
    {% endfor %}

    return isFreeProductInCart;
  }

  // Function to add the free product to the cart
  function addFreeProductToCart(productId) {
    // Check if the free product is already in the cart
    if (isFreeProductInCart(productId)) {
      alert('Free product is already in the cart.');
      return;
    }

    var params = {
      quantity: 1,
      id: productId
    };

    // Override the price of the free product to 0
    params.properties = {
      'PriceOverride': '0.00'
    };

    $.ajax({
      type: 'POST',
      url: '/cart/add.js',
      data: params,
      dataType: 'json',
      success: function () {
        // Cart update successful
        alert('Free product added to cart!');

        // Refresh the cart totals
        refreshCartTotals();
      },
      error: function () {
        // Error occurred
        alert('Error adding free product to cart!');
      }
    });
  }

  // Function to check the cart total and add the free product
  function checkCartTotal() {
    $.ajax({
      type: 'GET',
      url: '/cart.js',
      dataType: 'json',
      success: function(cart) {
        var cartTotal = cart.total_price;

        // Change the condition to match your currency and threshold
        if (cartTotal >= 10000) {
          // Call the function to add the free product
          addFreeProductToCart('44976669393191');
        }
      },
      error: function() {
        // Error occurred
        alert('Error retrieving cart information!');
      }
    });
  }

  // Function to refresh the cart totals
  function refreshCartTotals() {
    $.ajax({
      type: 'GET',
      url: '/cart.js',
      dataType: 'json',
      success: function(cart) {
        // Update the cart totals displayed on the page
        $('.cart-total').text('{{ shop.money_format }}' + cart.total_price);
      },
      error: function() {
        // Error occurred
        alert('Error retrieving cart information!');
      }
    });
  }

  // Call the checkCartTotal function when the document is ready
  $(document).ready(function() {
    checkCartTotal();
  });
</script>
